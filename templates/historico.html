{% extends 'base.html' %}

{% load static %}
{% block title %}Histórico de Limpeza{% endblock %}

{% block style %}
<link rel="stylesheet" type="text/css" href="{% static 'css/historico.css' %}">
{% endblock %}

{% block content %}
<div class="card">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Histórico de Limpeza</h2>
        <a href="{% url 'index_view' sala.id_sala %}" class="btn btn-secondary">Voltar</a>
    </div>

    <div class="mb-4">
        <p class="mb-1"><strong>Setor:</strong> {{ sala.nome_setor }}</p>
        <p><strong>Sala:</strong> {{ sala.nome_sala }}</p>
    </div>

    <div class="row g-3 align-items-end mb-4">
        <div class="col-md-4">
            <label class="form-label"><i class="fas fa-filter"></i> Tipo de Limpeza</label>
            <select id="tipoFilter" class="form-select">
                <option value="">Todos</option>
                <option value="terminal">Terminal</option>
                <option value="concorrente">Concorrente</option>
            </select>
        </div>
    </div>

    <hr>

    <div id="registros-container">
        {% for registro in registros %}
        <div class="registro-item {% if forloop.first %}destaque{% endif %}" data-tipo="{{ registro.tipo_limpeza }}">
            {% if forloop.first %}
            <div class="mb-2">
                <span class="badge bg-primary">ÚLTIMO REGISTRO</span>
            </div>
            {% endif %}

            <div class="row">
                <div class="col-md-6">
                    <p><i class="fas fa-user"></i> <strong>Colaborador(es):</strong></p>
                    <p style="white-space: pre-line; margin-left: 25px;">{{ registro.colaborador }}</p>
                    <p><i class="fas fa-calendar"></i> <strong>Data:</strong> {{ registro.data_limpeza|date:"d/m/Y" }} ({{ registro.data_limpeza|date:"D" }})</p>
                    <p><i class="fas fa-clock"></i> <strong>Hora:</strong> {{ registro.hora_limpeza }}</p>
                </div>
                <div class="col-md-6">
                    <p><strong>Tipo:</strong>
                        <span class="badge bg-{% if registro.tipo_limpeza == 'terminal' %}warning{% elif registro.tipo_limpeza == 'reposicao' %}success{% else %}info{% endif %}">
                            {{ registro.tipo_limpeza|upper }}
                        </span>
                    </p>
                    {% if registro.criticidade %}
                    <p><i class="fas fa-exclamation-triangle"></i> <strong>Criticidade:</strong> {{ registro.criticidade }}</p>
                    {% endif %}
                </div>
            </div>

            {% if registro.tipo_limpeza == 'terminal' %}
            <div class="mt-3">
                <strong>Itens Limpos:</strong>
                <div class="d-flex flex-wrap gap-2 mt-2">
                    {% if registro.portas != 'NA' %}<span class="badge badge-{{ registro.portas|lower }}">Portas: {{ registro.portas }}</span>{% endif %}
                    {% if registro.teto != 'NA' %}<span class="badge badge-{{ registro.teto|lower }}">Teto: {{ registro.teto }}</span>{% endif %}
                    {% if registro.paredes != 'NA' %}<span class="badge badge-{{ registro.paredes|lower }}">Paredes: {{ registro.paredes }}</span>{% endif %}
                    {% if registro.janelas != 'NA' %}<span class="badge badge-{{ registro.janelas|lower }}">Janelas: {{ registro.janelas }}</span>{% endif %}
                    {% if registro.piso != 'NA' %}<span class="badge badge-{{ registro.piso|lower }}">Piso: {{ registro.piso }}</span>{% endif %}
                    {% if registro.superficie_mobiliario != 'NA' %}<span class="badge badge-{{ registro.superficie_mobiliario|lower }}">Superfície: {{ registro.superficie_mobiliario }}</span>{% endif %}
                    {% if registro.dispenser != 'NA' %}<span class="badge badge-{{ registro.dispenser|lower }}">Dispenser: {{ registro.dispenser }}</span>{% endif %}
                </div>
            </div>
            {% endif %}

            {% if registro.tipo_limpeza == 'terminal' or registro.tipo_limpeza == 'reposicao' or registro.tipo_limpeza == 'concorrente' %}
            <div class="mt-3">
                <strong>Reposição:</strong>
                <div class="d-flex flex-wrap gap-2 mt-2">
                    {% if registro.papel_hig != 'NA' %}<span class="badge badge-{{ registro.papel_hig|lower }}">Papel Higiênico: {{ registro.papel_hig }}</span>{% endif %}
                    {% if registro.papel_toalha != 'NA' %}<span class="badge badge-{{ registro.papel_toalha|lower }}">Papel Toalha: {{ registro.papel_toalha }}</span>{% endif %}
                    {% if registro.alcool != 'NA' %}<span class="badge badge-{{ registro.alcool|lower }}">Álcool: {{ registro.alcool }}</span>{% endif %}
                    {% if registro.sabonete != 'NA' %}<span class="badge badge-{{ registro.sabonete|lower }}">Sabonete: {{ registro.sabonete }}</span>{% endif %}
                </div>
            </div>
            {% endif %}

            {% if registro.obs %}
            <div class="mt-3">
                <strong>Observações:</strong>
                <p class="mb-0">{{ registro.obs }}</p>
            </div>
            {% endif %}
        </div>
        {% empty %}
        <p class="text-center text-muted">Nenhum registro encontrado para esta sala.</p>
        {% endfor %}
    </div>

    {% if has_more %}
    <div class="text-center mt-3">
        <button id="btn-mostrar-mais" class="btn btn-primary" onclick="carregarMais()">Mostrar Mais</button>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
    {{ block.super }}
    <script>
        window.historicoData = {
            offset: {{ offset }},
            salaId: {{ sala.id_sala }}
        };
    </script>
    <script src="{% static 'js/historico.js' %}"></script>
{% endblock %}
